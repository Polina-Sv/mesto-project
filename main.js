(()=>{"use strict";var e=/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([/\w .-]*)*\/?$/,t=function(t){return"url"!==t.type||e.test(t.value)},n=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),o.textContent=n},o=function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.textContent=""},r=function(e,n){!function(e){return e.some((function(e){return"url"===e.type?!e.validity.valid||!t(e):!e.validity.valid}))}(e)?n.disabled=!1:n.setAttribute("disabled","")};var c={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"cb3806cb-88d1-4e58-a11c-6bd5290ec712","Content-Type":"application/json"}};function a(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var u=function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:c.headers}).then(a)},i=function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:c.headers}).then(a)};document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",(function(t){p(e.closest(".popup"))}))}));var l=function(e){var t=e.target.closest(".popup__content"),n=document.querySelector(".popup_is-opened");console.log(e.target),!t&&n&&p(n)},s=function(e){"Escape"!==e.key&&27!==e.keyCode||p(document.querySelector(".popup_is-opened"))};function d(e){e.classList.add("popup_is-opened"),e.addEventListener("click",l),document.addEventListener("keydown",s),console.log("1")}function p(e){e.classList.remove("popup_is-opened"),e.removeEventListener("click",l),document.removeEventListener("keydown",s)}var _=document.querySelector(".profile__title"),f=document.querySelector(".profile__description"),y=document.querySelector(".profile__image"),v=document.createElement("div");v.classList.add("profile__image_edit"),y.prepend(v);var m=document.querySelector(".profile__edit-button"),h=document.querySelector(".popup_type_edit");h.classList.add("popup_is-animated");var S=h.querySelector(".popup__form"),b=S.querySelector(".popup__input_type_name"),q=S.querySelector(".popup__input_type_description"),L=document.querySelector(".popup_type_avatar");L.classList.add("popup_is-animated");var k=L.querySelector(".popup__form"),E=k.querySelector(".popup__input_type_url");function g(e){_.textContent=e.name,f.textContent=e.about,y.style.backgroundImage="url(".concat(e.avatar,")"),y.onerror=function(){y.style.backgroundImage="url(../images/default_avatar.jpg)"}}function C(e){e.preventDefault();var t,n,r=S.querySelector(".popup__button"),u=r.textContent;r.textContent="Сохранение...",(t=b.value,n=q.value,fetch("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:t,about:n})}).then(a)).then((function(e){g(e),p(h)})).catch((function(e){console.error("Ошибка обновления профиля:",e)})).finally((function(){r.textContent=u,o(S,b),o(S,q)}))}function x(e){e.preventDefault();var t,n=k.querySelector(".popup__button"),r=n.textContent;n.textContent="Сохранение...",(t=E.value,fetch("".concat(c.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:t})}).then(a)).then((function(e){y.style.backgroundImage="url(".concat(e.avatar,")"),p(L)})).catch((function(e){console.error("Ошибка обновления аватара:",e)})).finally((function(){n.textContent=r,o(k,E)}))}var U=document.querySelector(".places__list"),A=document.querySelector(".profile__add-button"),T=document.querySelector(".popup_type_new-card");T.classList.add("popup_is-animated");var w=T.querySelector(".popup__form"),D=w.querySelector(".popup__input_type_card-name"),O=w.querySelector(".popup__input_type_url"),P=document.querySelector(".popup_type_image");P.classList.add("popup_is-animated");var j=P.querySelector(".popup__image"),N=P.querySelector(".popup__caption");function z(e,t){var n=document.querySelector("#card-template").content.cloneNode(!0).querySelector(".card"),o=n.querySelector(".card__image"),r=n.querySelector(".card__title"),l=n.querySelector(".card__like-button"),s=n.querySelector(".card__like-count"),p=n.querySelector(".card__delete-button");return o.src=e.link,o.alt=e.name,r.textContent=e.name,s.textContent=e.likes.length,e.likes.some((function(e){return e._id===t}))&&l.classList.add("card__like-button_is-active"),l.addEventListener("click",(function(){return function(e,t,n){(t.classList.contains("card__like-button_is-active")?i:u)(e).then((function(e){n.textContent=e.likes.length,t.classList.toggle("card__like-button_is-active")})).catch((function(e){console.error("Ошибка при обновлении лайка:",e)}))}(e._id,l,s)})),e.owner._id===t?(p.style.display="block",p.addEventListener("click",(function(){return function(e,t){(function(e){return fetch("".concat(c.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:c.headers}).then(a)})(e).then((function(){t.remove()})).catch((function(e){console.error("Ошибка удаления карточки:",e)}))}(e._id,n)}))):p.style.display="none",o.addEventListener("click",(function(){return function(e){j.src=e.link,j.alt=e.name,N.textContent=e.name,d(P)}(e)})),n}document.addEventListener("DOMContentLoaded",(function(){fetch("".concat(c.baseUrl,"/users/me"),{headers:c.headers}).then(a).then((function(e){return g(e),e})).catch((function(e){throw console.error("Ошибка загрузки профиля:",e),e})).then((function(e){var t;t=e._id,fetch("".concat(c.baseUrl,"/cards"),{headers:c.headers}).then(a).then((function(e){return function(e,t){U.innerHTML="",e.forEach((function(e){var n=z(e,t);U.append(n)}))}(e,t),e})).catch((function(e){throw console.error("Ошибка загрузки карточек:",e),e})),m.addEventListener("click",(function(){b.value=_.textContent,q.value=f.textContent,o(S,b),o(S,q),d(h)})),S.addEventListener("submit",C),function(e){A.addEventListener("click",(function(){w.reset(),o(w,D),o(w,O),d(T)})),w.addEventListener("submit",(function(t){return function(e,t){e.preventDefault();var n,r,u=w.querySelector(".popup__button"),i=u.textContent;u.textContent="Создание...",(n=D.value,r=O.value,fetch("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({name:n,link:r})}).then(a)).then((function(e){var n=z(e,t);U.prepend(n),p(T)})).catch((function(e){console.error("Ошибка добавления карточки:",e)})).finally((function(){u.textContent=i,o(w,D),o(w,O)}))}(t,e)}))}(e._id),v.addEventListener("click",(function(){k.reset(),o(k,E),d(L)})),k.addEventListener("submit",x)})).catch((function(e){console.error("Ошибка инициализации:",e)}))})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){!function(e){var c=Array.from(e.querySelectorAll(".popup__input")),a=e.querySelector(".popup__button");r(c,a),c.forEach((function(u){u.addEventListener("input",(function(){!function(e,r){"url"!==r.type||t(r)?r.validity.valid?o(e,r):n(e,r,r.validationMessage):n(e,r,"Введите корректный URL")}(e,u),r(c,a)}))}))}(e)}))})();