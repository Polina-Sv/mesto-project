(()=>{"use strict";var e=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.disabled=!1:t.setAttribute("disabled","")};var t={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"cb3806cb-88d1-4e58-a11c-6bd5290ec712","Content-Type":"application/json"}};function n(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var o=function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then(n)},r=function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then(n)};document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",(function(t){i(e.closest(".popup"))}))}));var c=function(e){var t=e.target.closest(".popup__content"),n=document.querySelector(".popup_is-opened");console.log(e.target),!t&&n&&i(n)},a=function(e){"Escape"!==e.key&&27!==e.keyCode||i(document.querySelector(".popup_is-opened"))};function u(e){e.classList.add("popup_is-opened"),e.addEventListener("click",c),document.addEventListener("keydown",a),console.log("1")}function i(e){e.classList.remove("popup_is-opened"),e.removeEventListener("click",c),document.removeEventListener("keydown",a)}var s=document.querySelector(".profile__title"),l=document.querySelector(".profile__description"),d=document.querySelector(".profile__image"),p=document.createElement("div");p.classList.add("profile__image_edit"),d.prepend(p);var _=document.querySelector(".profile__edit-button"),f=document.querySelector(".popup_type_edit");f.classList.add("popup_is-animated");var y=f.querySelector(".popup__form"),m=y.querySelector(".popup__input_type_name"),v=y.querySelector(".popup__input_type_description"),h=document.querySelector(".popup_type_avatar");h.classList.add("popup_is-animated");var S=h.querySelector(".popup__form"),b=S.querySelector(".popup__input_type_url");function q(e){s.textContent=e.name,l.textContent=e.about,d.style.backgroundImage="url(".concat(e.avatar,")"),d.onerror=function(){d.style.backgroundImage="url(../images/default_avatar.jpg)"}}function L(e){e.preventDefault();var o,r,c=y.querySelector(".popup__button"),a=c.textContent;c.textContent="Сохранение...",(o=m.value,r=v.value,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:o,about:r})}).then(n)).then((function(e){q(e),i(f)})).catch((function(e){console.error("Ошибка обновления профиля:",e)})).finally((function(){c.textContent=a}))}function k(e){e.preventDefault();var o,r=S.querySelector(".popup__button"),c=r.textContent;r.textContent="Сохранение...",(o=b.value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:o})}).then(n)).then((function(e){d.style.backgroundImage="url(".concat(e.avatar,")"),i(h)})).catch((function(e){console.error("Ошибка обновления аватара:",e)})).finally((function(){r.textContent=c}))}var E=document.querySelector(".places__list"),g=document.querySelector(".profile__add-button"),C=document.querySelector(".popup_type_new-card");C.classList.add("popup_is-animated");var x=C.querySelector(".popup__form"),U=x.querySelector(".popup__input_type_card-name"),A=x.querySelector(".popup__input_type_url"),T=document.querySelector(".popup_type_image");T.classList.add("popup_is-animated");var w=T.querySelector(".popup__image"),D=T.querySelector(".popup__caption");function O(e,c){var a=document.querySelector("#card-template").content.cloneNode(!0).querySelector(".card"),i=a.querySelector(".card__image"),s=a.querySelector(".card__title"),l=a.querySelector(".card__like-button"),d=a.querySelector(".card__like-count"),p=a.querySelector(".card__delete-button");return i.src=e.link,i.alt=e.name,s.textContent=e.name,d.textContent=e.likes.length,e.likes.some((function(e){return e._id===c}))&&l.classList.add("card__like-button_is-active"),l.addEventListener("click",(function(){return function(e,t,n){(t.classList.contains("card__like-button_is-active")?r:o)(e).then((function(e){n.textContent=e.likes.length,t.classList.toggle("card__like-button_is-active")})).catch((function(e){console.error("Ошибка при обновлении лайка:",e)}))}(e._id,l,d)})),e.owner._id===c?(p.style.display="block",p.addEventListener("click",(function(){return function(e,o){(function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers}).then(n)})(e).then((function(){o.remove()})).catch((function(e){console.error("Ошибка удаления карточки:",e)}))}(e._id,a)}))):p.style.display="none",i.addEventListener("click",(function(){return function(e){w.src=e.link,w.alt=e.name,D.textContent=e.name,u(T)}(e)})),a}document.addEventListener("DOMContentLoaded",(function(){fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then(n).then((function(e){return q(e),e})).catch((function(e){throw console.error("Ошибка загрузки профиля:",e),e})).then((function(e){var o;o=e._id,fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then(n).then((function(e){return function(e,t){E.innerHTML="",e.forEach((function(e){var n=O(e,t);E.append(n)}))}(e,o),e})).catch((function(e){throw console.error("Ошибка загрузки карточек:",e),e})),_.addEventListener("click",(function(){m.value=s.textContent,v.value=l.textContent,u(f)})),y.addEventListener("submit",L),function(e){g.addEventListener("click",(function(){x.reset(),u(C)})),x.addEventListener("submit",(function(o){return function(e,o){e.preventDefault();var r,c,a=x.querySelector(".popup__button"),u=a.textContent;a.textContent="Создание...",(r=U.value,c=A.value,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:r,link:c})}).then(n)).then((function(e){var t=O(e,o);E.prepend(t),i(C)})).catch((function(e){console.error("Ошибка добавления карточки:",e)})).finally((function(){a.textContent=u}))}(o,e)}))}(e._id),p.addEventListener("click",(function(){S.reset(),u(h)})),S.addEventListener("submit",k)})).catch((function(e){console.error("Ошибка инициализации:",e)}))})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(t){!function(t){var n=Array.from(t.querySelectorAll(".popup__input")),o=t.querySelector(".popup__button");e(n,o),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t){t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.textContent=""}(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),o.textContent=n}(e,t,t.validationMessage)}(t,r),e(n,o)}))}))}(t)}))})();